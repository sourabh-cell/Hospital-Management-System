<!-- ambulance-view.html -->
<div th:fragment="ambulance-view" xmlns:th="http://www.thymeleaf.org">
    <div class="container-fluid mt-5">
        <!-- ============================ -->
        <!-- Title Bar Section -->
        <!-- ============================ -->
        <div class="position-relative heading text-white p-3 rounded-top ">
            <div class="header d-flex font-size justify-content-center align-items-center gap-2" style="padding: 10px 5px;">
                <i class="fa-solid fa-truck-medical"></i>
                <h4 class="mb-0">Ambulance Management Dashboard</h4>
            </div>
        </div>

        <!-- ============================ -->
        <!-- Tabs Navigation -->
        <!-- ============================ -->
        <div class="border rounded-bottom p-3 bg-white" style="border: none;">
            <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="ambulance-tab" data-bs-toggle="tab" href="#ambulanceData" role="tab">View Ambulance</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="driver-tab" data-bs-toggle="tab" href="#driverData" role="tab">View Driver</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="assignment-tab" data-bs-toggle="tab" href="#assignmentData" role="tab">View Ambulance Assignment</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="assignment-history-tab" data-bs-toggle="tab" href="#assignmentHistoryData" role="tab">View Ambulance Assignment Completed</a>
                </li>
            </ul>

            <!-- ============================ -->
            <!-- Tab Content -->
            <!-- ============================ -->
            <div class="tab-content mt-3">
                <!-- Ambulance Table -->
                <div class="tab-pane fade show active" id="ambulanceData" role="tabpanel">
                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                        <tr>
                            <th>Sr.No</th>
                            <th>Ambulance Number</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Last Maintenance Date</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="amb, iterStat : ${ambulances}">
                            <td th:text="${iterStat.count}"></td>
                            <td th:text="${amb.vehicleNumber}"></td>
                            <td th:text="${amb.ambulanceType}"></td>
                            <td th:text="${amb.ambulanceStatus}"></td>
                            <td th:text="${amb.lastMaintenanceDate}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Driver Table -->
                <div class="tab-pane fade" id="driverData" role="tabpanel">
                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                        <tr>
                            <th>Sr.No</th>
                            <th>Driver Name</th>
                            <th>License Number</th>
                            <th>Phone</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="drv, iterStat : ${drivers}">
                            <td th:text="${iterStat.count}"></td>
                            <td th:text="${drv.driverName}"></td>
                            <td th:text="${drv.licenseNumber}"></td>
                            <td th:text="${drv.contactNumber}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Assignment Table -->
                <div class="tab-pane fade" id="assignmentData" role="tabpanel">
                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                        <tr>
                            <th>Sr.No</th>
                            <th>Ambulance</th>
                            <th>Driver</th>
                            <th>Patient</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Status</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="assign, iterStat : ${assignments}">
                            <td th:text="${iterStat.count}"></td>
                            <td th:text="${assign.ambulance.vehicleNumber}"></td>
                            <td th:text="${assign.driver.driverName}"></td>
                            <td th:text="${assign.patient != null ? assign.patient.firstName : '-'}"></td>
                            <td th:text="${assign.fromLocation}"></td>
                            <td th:text="${assign.toLocation}"></td>
                            <td>
                                <span th:text="${assign.status}" class="status-text"></span>
                                <button type="button" class="edit-status-btn" onclick="showDropdown(this)">Change</button>
                                <form th:action="@{/assignments/changeStatus/{id}(id=${assign.id})}" method="post" style="display:inline">
                                    <select name="status" class="status-dropdown" style="display:none;" onchange="this.form.submit()">
                                        <option value="SCHEDULED" th:selected="${assign.status == 'SCHEDULED'}">Scheduled</option>
                                        <option value="IN_PROGRESS" th:selected="${assign.status == 'IN_PROGRESS'}">In Progress</option>
                                        <option value="COMPLETED" th:selected="${assign.status == 'COMPLETED'}">Completed</option>
                                    </select>
                                </form>
                            </td>
                            <td th:text="${#temporals.format(assign.startTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${#temporals.format(assign.endTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Assignment History Table -->
                <div class="tab-pane fade" id="assignmentHistoryData" role="tabpanel">
                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                        <tr>
                            <th>Sr.No</th>
                            <th>Ambulance</th>
                            <th>Driver</th>
                            <th>Patient</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Status</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="assign, iterStat : ${completedAssignments}">
                            <td th:text="${iterStat.count}"></td>
                            <td th:text="${assign.ambulance.vehicleNumber}"></td>
                            <td th:text="${assign.driver.driverName}"></td>
                            <td th:text="${assign.patient != null ? assign.patient.firstName : '-'}"></td>
                            <td th:text="${assign.fromLocation}"></td>
                            <td th:text="${assign.toLocation}"></td>
                            <td th:text="${assign.status}"></td>
                            <td th:text="${#temporals.format(assign.startTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${#temporals.format(assign.endTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- JS for status dropdown -->
    <script>
        function showDropdown(button) {
            const td = button.parentElement;
            const span = td.querySelector('.status-text');
            const select = td.querySelector('.status-dropdown');
            span.style.display = 'none';
            button.style.display = 'none';
            select.style.display = 'inline-block';
        }
    </script>

    <!-- Bootstrap JS -->
    <script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js}"></script>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}" rel="stylesheet" />
</div>
